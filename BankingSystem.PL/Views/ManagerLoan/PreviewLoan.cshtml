@using BankingSystem.DAL.Models
@model BankingSystem.PL.ViewModels.Manager.LoanDetailsViewModel

@{
    ViewData["Title"] = "Loan Details";
}

<div class="container-fluid">
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Loan Details</h1>
        <a asp-action="GetAllLoans" class="d-none d-sm-inline-block btn btn-sm btn-outline-primary shadow-sm">
            <i class="fas fa-chevron-left fa-sm"></i> Back to List
        </a>
    </div>

    <div class="card shadow mb-4">
        <div class="card-header bg-primary text-white py-3">
            <h6 class="m-0 font-weight-bold">Loan Information</h6>
        </div>
        <div class="card-body">
            <div class="row">
                <!-- Left Column -->
                <div class="col-md-6">
                    <dl class="row">
                        <dt class="col-sm-5">Loan Amount:</dt>
                        <dd class="col-sm-7">@Model.Loan.LoanAmount.ToString("C")</dd>

                        <dt class="col-sm-5">Current Debt:</dt>
                        <dd class="col-sm-7">@Model.Loan.CurrentDebt.ToString("C")</dd>

                        <dt class="col-sm-5">Interest Rate:</dt>
                        <dd class="col-sm-7">@Model.Loan.InterestRate%</dd>

                        <dt class="col-sm-5">Duration:</dt>
                        <dd class="col-sm-7">@Model.Loan.DurationInMonth months</dd>

                        <dt class="col-sm-5">Customer Name:</dt>
                        <dd class="col-sm-7">@Model.Loan.CustomerName</dd>
                    </dl>
                </div>

                <!-- Right Column -->
                <div class="col-md-6">
                    <dl class="row">
                        <dt class="col-sm-5">Status:</dt>
                        <dd class="col-sm-7">
                            <span class="badge @GetStatusBadgeClass(Model.Loan.LoanStatus) ">
                                @Model.Loan.LoanStatus
                            </span>
                            @if (Model.Loan.LoanStatus == LoanStatus.Pending)
                            {
                                <a asp-action="AcceptLoan" asp-route-LoanId="@Model.Id" class="badge badge-warning text-bg-warning">
                                    <i class="fas fa-clock"></i> Accept
                                </a>
                                <a asp-action="DenyLoan" asp-route-LoanId="@Model.Id" class="badge badge-danger text-bg-danger">
                                    <i class="fas fa-times"></i> Deny
                                </a>
                            }
                        </dd>

                        <dt class="col-sm-5">Type:</dt>
                        <dd class="col-sm-7">
                            <span>@Model.Loan.LoanType</span>
                        </dd>

                        <dt class="col-sm-5">Start Date:</dt>
                        <dd class="col-sm-7">@Model.Loan.StartDate.ToString("dd MMM yyyy")</dd>

                        <dt class="col-sm-5">Account Number:</dt>
                        <dd class="col-sm-7">@Model.Loan.AccountNumber</dd>

                    </dl>
                </div>
            </div>
        </div>
    </div>

    <!-- Financial Overview Section -->
    <div class="row">
        @* <!-- Income Sources --> *@
        @* <div class="col-lg-6 mb-4"> *@
        @*     <div class="card shadow h-100"> *@
        @*         <div class="card-header bg-success text-white py-3"> *@
        @*             <h6 class="m-0 font-weight-bold"> *@
        @*                 <i class="fas fa-money-bill-wave mr-2"></i>Income Sources *@
        @*             </h6> *@
        @*         </div> *@
        @*         <div class="card-body"> *@
        @*             @if (Model.FinancialDocument!= null) *@
        @*             { *@
                      
        @*             } *@
        @*             else *@
        @*             { *@
        @*                 <div class="alert alert-warning mb-0">No additional income sources declared</div> *@
        @*             } *@
        @*         </div> *@
        @*     </div> *@
        @* </div> *@

        <!-- Assets -->
        @* <div class="col-lg-6 mb-4"> *@
        @*     <div class="card shadow h-100"> *@
        @*         <div class="card-header bg-info text-white py-3"> *@
        @*             <h6 class="m-0 font-weight-bold"> *@
        @*                 <i class="fas fa-landmark mr-2"></i>Declared Assets *@
        @*             </h6> *@
        @*         </div> *@
        @*         <div class="card-body"> *@
        @*             @if (Model.Assets?.Any() == true) *@
        @*             { *@
        @*                 <div class="row"> *@
        @*                     @foreach (var asset in Model.Assets) *@
        @*                     { *@
        @*                         <div class="col-md-6 mb-3"> *@
        @*                             <div class="card border-left-primary h-100"> *@
        @*                                 <div class="card-body"> *@
        @*                                     <div class="d-flex align-items-center"> *@
        @*                                         <div class="mr-3"> *@
        @*                                             <i class="fas @GetAssetIcon(asset.Type) fa-2x text-gray-500"></i> *@
        @*                                         </div> *@
        @*                                         <div> *@
        @*                                             <div class="text-xs font-weight-bold text-primary text-uppercase"> *@
        @*                                                 @asset.Type *@
        @*                                             </div> *@
        @*                                             <div class="h6 mb-0 font-weight-bold text-gray-800"> *@
        @*                                                 @asset.EstimatedValue.ToString("C") *@
        @*                                             </div> *@
        @*                                         </div> *@
        @*                                     </div> *@
        @*                                 </div> *@
        @*                             </div> *@
        @*                         </div> *@
        @*                     } *@
        @*                 </div> *@
        @*             } *@
        @*             else *@
        @*             { *@
        @*                 <div class="alert alert-warning mb-0">No assets declared</div> *@
        @*             } *@
        @*         </div> *@
        @*     </div> *@
        @* </div> *@
    </div>
    <!-- Payment History -->
    <div class="card shadow mb-4">
        <div class="card-header bg-secondary text-white py-3">
            <h6 class="m-0 font-weight-bold">Payment History</h6>
        </div>
        <div class="card-body">
            @if (Model.Payments?.Any() == true)
            {
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="thead-dark">
                            <tr>
                                <th>Date</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var payment in Model.Payments)
                            {
                                <tr>
                                    <td>@payment.PaymentDate.ToString("dd MMM yyyy")</td>
                                    <td>@payment.Amount.ToString("C")</td>
                                </tr>
                            }
                        </tbody>
                        <tfoot>
                            <tr class="table-info">
                                <td><strong>Total Paid:</strong></td>
                                <td><strong>@Model.Payments.Sum(p => p.Amount).ToString("C")</strong></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            }
            else
            {
                <div class="alert alert-warning">No payment history found</div>
            }
        </div>
    </div>
</div>

@functions {
    string GetStatusBadgeClass(LoanStatus status)
    {
        return status switch
        {
            LoanStatus.Accepted => "badge-success text-bg-success",
            LoanStatus.Pending => "badge-warning text-bg-primary",
            LoanStatus.Denied => "badge-danger text-bg-danger",
            LoanStatus.Paid => "badge-success text-bg-success",
            _ => "badge-secondary text-bg-danger"
        };
    }
    string GetAssetIcon(string assetType)
    {
        return assetType switch
        {
            "Property" => "fa-home",
            "Vehicle" => "fa-car",
            "Investment" => "fa-chart-line",
            _ => "fa-piggy-bank"
        };
    }
}

<style>
    dt {
        font-weight: 500;
        color: #6c757d;
    }

    .card {
        border-radius: 0.35rem;
    }

    .table th {
        border-top: none;
    }

    .badge {
        font-size: 0.85em;
        padding: 0.5em 0.75em;
    }
</style>