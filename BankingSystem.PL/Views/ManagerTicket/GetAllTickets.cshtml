@using BankingSystem.DAL.Models
@model List<TicketsViewModel>
@{
    ViewData["Title"] = "Support Tickets List";
}

<div class="container mt-4">
    <h2 class="mb-4">Support Tickets in Your Branch</h2>
    <div class="mb-3">
        <input type="number" id="searchInput" placeholder="Search by Account Number or Customer Name" class="form-control" />
        <label>Search</label>
    </div>
    @if (!Model.Any())
    {
        <div class="alert alert-info" role="alert">
            No support tickets found in this branch.
        </div>
    }
    else
    {
        <div class="mb-3">
            <div class="row justify-content-center">
                <div class="col-md-10 col-lg-8">
                    <div class="row justify-content-center">
                        <h3 class="text-center mb-3 col-3">Ticket Type</h3>
                        <div class="d-flex flex-wrap justify-content-center gap-2 mb-4 col-9">
                            <button class="btn btn-outline-primary btn-sm filter-btn px-3 rounded-pill"
                                    data-filter-type="ticket-type" data-filter-value="Technical">
                                <i class="fas fa-laptop me-2"></i>Technical
                            </button>
                            <button class="btn btn-outline-primary btn-sm filter-btn px-3 rounded-pill"
                                    data-filter-type="ticket-type" data-filter-value="Billing">
                                <i class="fas fa-receipt me-2"></i>Billing
                            </button>
                            <button class="btn btn-outline-primary btn-sm filter-btn px-3 rounded-pill"
                                    data-filter-type="ticket-type" data-filter-value="Account">
                                <i class="fas fa-user me-2"></i>Account
                            </button>
                            <button class="btn btn-outline-primary btn-sm filter-btn px-3 rounded-pill"
                                    data-filter-type="ticket-type" data-filter-value="Other">
                                <i class="fas fa-ellipsis-h me-2"></i>Other
                            </button>
                            <button class="btn btn-outline-secondary btn-sm filter-btn px-3 rounded-pill"
                                    data-filter-type="ticket-type" data-filter-value="all">
                                <i class="fas fa-filter me-2"></i>All Types
                            </button>
                        </div>
                    </div>
                    <div class="row justify-content-center">
                        <h3 class="text-center mb-3 col-3">Ticket Status</h3>
                        <div class="d-flex flex-wrap justify-content-center gap-2 mb-4 col-9">
                            <button class="btn btn-outline-warning btn-sm filter-btn px-3 rounded-pill"
                                    data-filter-type="ticket-status" data-filter-value="Pending">
                                <i class="fas fa-clock me-2"></i>Pending
                            </button>
                            <button class="btn btn-outline-info btn-sm filter-btn px-3 rounded-pill"
                                    data-filter-type="ticket-status" data-filter-value="InProgress">
                                <i class="fas fa-spinner me-2"></i>In Progress
                            </button>
                            <button class="btn btn-outline-success btn-sm filter-btn px-3 rounded-pill"
                                    data-filter-type="ticket-status" data-filter-value="Resolved">
                                <i class="fas fa-check-circle me-2"></i>Resolved
                            </button>
                            <button class="btn btn-outline-secondary btn-sm filter-btn px-3 rounded-pill"
                                    data-filter-type="ticket-status" data-filter-value="Closed">
                                <i class="fas fa-archive me-2"></i>Closed
                            </button>
                            <button class="btn btn-outline-secondary btn-sm filter-btn px-3 rounded-pill"
                                    data-filter-type="ticket-status" data-filter-value="all">
                                <i class="fas fa-filter me-2"></i>All Statuses
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <table class="table table-striped table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>Customer Name</th>
                    <th>Account Number</th>
                    <th>Title</th>
                    <th>Type</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Teller</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var ticket in Model)
                {
                    <tr data-ticket-type="@ticket.Type" data-ticket-status="@ticket.Status">
                        <td>@ticket.CustomerName</td>
                        <td>@ticket.CustomerAccountNumber</td>
                        <td>@ticket.Title</td>
                        <td>@ticket.Type</td>
                        <td>@ticket.Date.ToString("d")</td>
                        <td>
                            @{
                                var statusClass = ticket.Status switch
                                {
                                    SupportTicketStatus.Pending => "bg-warning text-dark",
                                    SupportTicketStatus.InProgress => "bg-info",
                                    SupportTicketStatus.Resolved => "bg-success",
                                    SupportTicketStatus.Denied => "bg-secondary",
                                    _ => "bg-secondary"
                                };
                            }
                            <span class="badge @statusClass">@ticket.Status</span>
                        </td>
                        <td>@ticket.TellerName</td>
                        <td>
                            <a asp-controller="ManagerTicket"
                               asp-action="PreviewTicket"
                               asp-route-TicketId="@ticket.Id"
                               class="btn btn-primary btn-sm">
                                Details
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script src="~/js/FilteringTickets.js"></script>
}